<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cloudflare R2 Images</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .image-test {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            border: 2px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
        }
        .status {
            margin-top: 10px;
            padding: 5px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Cloudflare R2 Image Testing</h1>
    
    <div class="info">
        <strong>Debugging Image Loading Issues</strong><br>
        This page tests if images from Cloudflare R2 can be loaded in your browser.
        Open the browser console (F12) to see detailed error messages.
    </div>

    <div class="test-container">
        <h2>Test Your Image URL</h2>
        <input 
            type="text" 
            id="testUrl" 
            class="url-input" 
            placeholder="Enter image URL to test..."
            value="https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/powder-blue-model.png"
        >
        <button onclick="testImage()">Test Image</button>
        <div id="testResult" style="margin-top: 20px;"></div>
    </div>

    <div class="test-container">
        <h2>Suspender & Bowtie Set Images</h2>
        <div class="image-test" id="imageGrid">
            <!-- Images will be added here -->
        </div>
    </div>

    <div class="test-container">
        <h2>Network Diagnostics</h2>
        <pre id="diagnostics"></pre>
    </div>

    <script>
        // Your product images
        const productImages = [
            'https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/powder-blue-model.png',
            'https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/navy-blue-model.png',
            'https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/black-model.png',
            'https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/burgundy-model.png',
            'https://pub-8ea0502158a94b8ca8a7abb9e18a57e8.r2.dev/main-suspender-bowtie-set/gray-model.png'
        ];

        function testImage() {
            const url = document.getElementById('testUrl').value;
            const resultDiv = document.getElementById('testResult');
            
            resultDiv.innerHTML = '<p>Testing image...</p>';
            
            const img = new Image();
            const startTime = Date.now();
            
            img.onload = function() {
                const loadTime = Date.now() - startTime;
                resultDiv.innerHTML = `
                    <div class="status success">✅ Image loaded successfully!</div>
                    <p>Load time: ${loadTime}ms</p>
                    <p>Dimensions: ${img.width} x ${img.height}</p>
                    <img src="${url}" style="max-width: 300px; margin-top: 10px; border: 1px solid #ddd;">
                `;
                console.log('Image loaded:', url, {
                    width: img.width,
                    height: img.height,
                    loadTime: loadTime + 'ms'
                });
            };
            
            img.onerror = function(e) {
                resultDiv.innerHTML = `
                    <div class="status error">❌ Failed to load image</div>
                    <p>URL: ${url}</p>
                    <p>Possible issues:</p>
                    <ul style="text-align: left;">
                        <li>CORS policy blocking the image</li>
                        <li>Invalid URL or image doesn't exist</li>
                        <li>Network connectivity issues</li>
                        <li>R2 bucket permissions</li>
                    </ul>
                `;
                console.error('Image failed to load:', url, e);
                
                // Try fetch to get more details
                fetch(url, { mode: 'no-cors' })
                    .then(() => {
                        console.log('Fetch succeeded (no-cors mode) - image exists but might have CORS issues');
                    })
                    .catch(err => {
                        console.error('Fetch also failed:', err);
                    });
            };
            
            img.src = url;
        }

        function loadProductImages() {
            const grid = document.getElementById('imageGrid');
            
            productImages.forEach((url, index) => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `
                    <img src="${url}" 
                         alt="Product ${index + 1}"
                         onload="this.parentElement.querySelector('.status').className='status success'; this.parentElement.querySelector('.status').textContent='✅ Loaded';"
                         onerror="this.parentElement.querySelector('.status').className='status error'; this.parentElement.querySelector('.status').textContent='❌ Failed'; console.error('Failed:', '${url}');">
                    <div class="status">Loading...</div>
                    <small style="word-break: break-all; font-size: 10px; color: #666;">
                        ${url.split('/').pop()}
                    </small>
                `;
                grid.appendChild(card);
            });
        }

        async function runDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            let report = 'Running diagnostics...\n\n';
            
            // Test one image with fetch
            const testUrl = productImages[0];
            
            try {
                // Test with different fetch modes
                report += 'Testing fetch modes:\n';
                
                // No-cors mode (won't give us response details but tells us if resource exists)
                try {
                    await fetch(testUrl, { mode: 'no-cors' });
                    report += '✅ no-cors mode: Resource accessible\n';
                } catch (e) {
                    report += '❌ no-cors mode failed: ' + e.message + '\n';
                }
                
                // CORS mode (will fail if CORS not configured)
                try {
                    const response = await fetch(testUrl, { mode: 'cors' });
                    report += '✅ CORS mode: Headers properly configured\n';
                    report += `   Status: ${response.status}\n`;
                    report += `   Content-Type: ${response.headers.get('Content-Type')}\n`;
                } catch (e) {
                    report += '⚠️ CORS mode failed (expected if CORS not configured): ' + e.message + '\n';
                }
                
            } catch (e) {
                report += 'Error during diagnostics: ' + e.message + '\n';
            }
            
            // Check if images are HTTPS
            report += '\n✅ All URLs use HTTPS\n';
            
            // Browser info
            report += '\nBrowser Info:\n';
            report += `User Agent: ${navigator.userAgent}\n`;
            
            diagnostics.textContent = report;
        }

        // Run tests on load
        window.onload = function() {
            loadProductImages();
            runDiagnostics();
            
            // Test the first image automatically
            setTimeout(testImage, 1000);
        };
    </script>
</body>
</html>